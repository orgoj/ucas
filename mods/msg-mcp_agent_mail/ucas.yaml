# MCP Agent Mail communication module

mods+:
  - name: msg-mcp_agent_mail
    description: "Multi-agent messaging and coordination via MCP Agent Mail"

env+:
  AGENT_NAME: "$UCAS_AGENT"
  AM_PROJECT_KEY: "$UCAS_PROJECT_ROOT"

hooks+:
  install:
    - mkdir -p "$HOME/.mcp-agent-mail"
    - |
      if [ ! -f "$HOME/.mcp-agent-mail/client-config" ]; then
        echo 'BASE_URL="http://localhost:8765/mcp/"' > "$HOME/.mcp-agent-mail/client-config"
        echo 'BEARER_TOKEN=""' >> "$HOME/.mcp-agent-mail/client-config"
        echo 'PROJECT_KEY=""' >> "$HOME/.mcp-agent-mail/client-config"
      fi
    - |
      # Start server if we are the first agent in a team (or running solo)
      if [ "${UCAS_TEAM_INDEX:-0}" = "0" ]; then
        /home/michael/work/ai/PROJECTS/ucas/mods/msg-mcp_agent_mail/scripts/ensure-server.sh
      fi
  prerun:
    - |
      # Automatic project assurance and agent registration
      # Env vars AGENT_NAME and AM_PROJECT_KEY are provided by UCAS env mod feature
      /home/michael/work/ai/Dicklesworthstone/mcp_agent_mail/scripts/am-client ensure-project "$AM_PROJECT_KEY" > /dev/null 2>&1 || true
      /home/michael/work/ai/Dicklesworthstone/mcp_agent_mail/scripts/am-client register --project "$AM_PROJECT_KEY"
